<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toggle Debug Windows</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 32px;
            color: #4CAF50;
            text-transform: uppercase;
        }

        input[type="file"] {
            display: none;
        }

        label {
            padding: 12px 24px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        label:hover {
            background-color: #45a049;
        }

        #buttonContainer {
            margin-top: 20px;
            display: none;
            text-align: center;
        }

        #getDebugWindowsButton {
            display: none; /* Hide this button initially */
        }

        button {
            padding: 12px 24px;
            font-size: 18px;
            color: white;
            background-color: #4CAF50;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
        }

        button:hover {
            background-color: #45a049;
        }

        h3 {
            margin-top: 40px;
            font-size: 18px;
            color: #555;
            text-align: center;
            max-width: 600px;
        }
    </style>
</head>

<body>
    <h1>Toggle Debug Windows</h1>
    <input type="file" id="fileInput" accept=".cods" onchange="showButtons()">
    <label for="fileInput">Import .cods File</label>

    <div id="buttonContainer">
        <p>Toggle Debug Windows:</p>
        <button onclick="setOption('Yes')">Yes</button>
        <button onclick="setOption('No')">No</button>
    </div>

    <h3>1. Click Import .cods file. Find the .cods file then once imported, an option will appear. Click on Yes if you want debug windows or No if you donâ€™t, then you are done! RESTART CHROMEBOOK, go back to this page once signed in, then press the get debug windows button.</h3>

    <!-- "Get Debug Windows" button -->
    <button id="getDebugWindowsButton" onclick="goToDebugWindows()">Get Debug Windows</button>

    <script>
        // Function to show buttons when a file is imported
        function showButtons() {
            const fileInput = document.getElementById('fileInput');
            const buttonContainer = document.getElementById('buttonContainer');

            if (fileInput.files.length > 0) {
                buttonContainer.style.display = 'block';
            }
        }

        // Function to handle the user's choice and save it in localStorage
        function setOption(option) {
            localStorage.setItem('debugOption', option); // Save option in localStorage
            alert('Option set: ' + option);

            // Save current time as the restartTimestamp (will check this after reboot)
            const currentTime = new Date().getTime();
            localStorage.setItem('restartTimestamp', currentTime);

            // Show the "Get Debug Windows" button immediately if option is set
            document.getElementById('getDebugWindowsButton').style.display = 'block';
        }

        // Function to detect if Chromebook has been restarted
        function checkIfRestarted() {
            const lastVisit = localStorage.getItem('lastVisit');
            const currentTime = new Date().getTime();

            if (lastVisit) {
                const timeSinceLastVisit = currentTime - lastVisit;

                // Assume Chromebook has restarted if more than 10 seconds have passed (or storage was cleared)
                if (timeSinceLastVisit > 30000) { 
                    return true;
                }
            }
            return false;
        }

        // Function to navigate to debugwindows.html
        function goToDebugWindows() {
            window.location.href = 'debugwindows.html';
        }

        // On page load, check if a debug option was already selected and if the Chromebook has restarted
        window.onload = () => {
            const savedOption = localStorage.getItem('debugOption');
            const restartDetected = checkIfRestarted();

            // Update the last visit time in localStorage to track reboots
            const currentTime = new Date().getTime();
            localStorage.setItem('lastVisit', currentTime);

            if (savedOption) {
                document.getElementById('buttonContainer').style.display = 'block'; // Show the buttons
                alert('Previous option: ' + savedOption);

                // If the Chromebook has been restarted, show the "Get Debug Windows" button
                if (restartDetected) {
                    document.getElementById('getDebugWindowsButton').style.display = 'block';
                }
            }
        };
    </script>
</body>

</html>
